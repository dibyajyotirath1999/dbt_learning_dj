create role if not exists dbt_learn_demo;
grant role dbt_learn_demo to role sysadmin;
grant role dbt_learn_demo to user nandysusovan;
create or replace warehouse transforming with warehouse_size='X-SMALL';
create database if not exists analytics;
create schema if not exists analytics.raw_lob1;

grant all on warehouse transforming to role dbt_learn_demo; 
grant all on database analytics to role dbt_learn_demo;
grant all on all schemas in database analytics to role dbt_learn_demo;
grant all on future schemas in database analytics to role dbt_learn_demo;
grant all on all tables in schema analytics.raw_lob1 to role dbt_learn_demo;
grant all on future tables in schema analytics.raw_lob1 to role dbt_learn_demo;

show grants to role dbt_learn_demo;

create or replace sequence stg_src1_bill_hist_pk start = 1 increment = 1;
create or replace sequence stg_src1_bill_hist_tbl_pk start = 1 increment = 1;
grant all on all sequences in schema analytics.dev to role dbt_learn_demo;
grant all on future sequences in schema analytics.dev to role dbt_learn_demo;

grant all on all tables in schema analytics.dev to role dbt_learn_demo;
grant all on future tables in schema analytics.dev to role dbt_learn_demo;

create schema if not exists analytics.meta;
grant all on all tables in schema analytics.meta to role dbt_learn_demo;
grant all on future tables in schema analytics.meta to role dbt_learn_demo;



--------------------
create or replace TABLE RAW_SRC1_BILLING_HISTORY (
	KEY_HASH VARCHAR(16777216),
	ROW_HASH VARCHAR(16777216),
	CORPSUF VARCHAR(16777216),
	PHMAIN VARCHAR(16777216),
	PHBRN VARCHAR(16777216),
	PHDEPT VARCHAR(16777216),
	CRTNUM VARCHAR(16777216),
	CRTTB VARCHAR(16777216),
	INVNUM VARCHAR(16777216),
	PLNNUM VARCHAR(16777216),
	PLNTYP VARCHAR(16777216),
	DUECC VARCHAR(16777216),
	DUEYR VARCHAR(16777216),
	DUEMO VARCHAR(16777216),
	DUEDAY VARCHAR(16777216),
	ARTYP VARCHAR(16777216),
	ARSUBTYP VARCHAR(16777216),
	DOCNUM VARCHAR(16777216),
	TRNCC VARCHAR(16777216),
	TRNYR VARCHAR(16777216),
	TRNMO VARCHAR(16777216),
	TRNDAY VARCHAR(16777216),
	DOCCC VARCHAR(16777216),
	DOCYR VARCHAR(16777216),
	DOCMO VARCHAR(16777216),
	DOCDAY VARCHAR(16777216),
	PLNEFFCC VARCHAR(16777216),
	PLNEFFMDY VARCHAR(16777216),
	RTENUM VARCHAR(16777216),
	RTEEFFCC VARCHAR(16777216),
	RTEEFFMDY VARCHAR(16777216),
	PHEFFCC VARCHAR(16777216),
	PHEFFMDY VARCHAR(16777216),
	PHST VARCHAR(16777216),
	BILLVL VARCHAR(16777216),
	BILFRQ VARCHAR(16777216),
	BILCYC VARCHAR(16777216),
	DOCAMT VARCHAR(16777216),
	COMAMT VARCHAR(16777216),
	ORGNID VARCHAR(16777216),
	STS VARCHAR(16777216),
	SRCPSTID VARCHAR(16777216),
	SRCTRNTYP VARCHAR(16777216),
	EECNT VARCHAR(16777216),
	EECNTNEW VARCHAR(16777216),
	EECNTREN VARCHAR(16777216),
	VOLAMT VARCHAR(16777216),
	VOLAMTNEW VARCHAR(16777216),
	VOLAMTREN VARCHAR(16777216),
	DOCAMTNEW VARCHAR(16777216),
	DOCAMTREN VARCHAR(16777216),
	FIL001 VARCHAR(16777216),
	SRC_FILE_NAME VARCHAR(16777216),
	REC_CREATE_DTTM TIMESTAMP_NTZ(9),
	REC_UPDT_DTTM TIMESTAMP_NTZ(9),
	CYC_RUN_SK NUMBER(38,0),
	SRC_NM VARCHAR(16777216),
	PROCESS_FLAG VARCHAR(1),
	DQ_FLAG BOOLEAN
);

create or replace TABLE RAW_SRC1_BILLING_HISTORY_TBL (
	KEY_HASH VARCHAR(16777216),
	ROW_HASH VARCHAR(16777216),
	CORPNUM VARCHAR(16777216),
	CORPSUF VARCHAR(16777216),
	PHMAIN VARCHAR(16777216),
	PHBRN VARCHAR(16777216),
	PHDEPT VARCHAR(16777216),
	CRTNUM VARCHAR(16777216),
	CRTTB VARCHAR(16777216),
	INVNUM VARCHAR(16777216),
	PLNNUM VARCHAR(16777216),
	PLNTYP VARCHAR(16777216),
	DUECC VARCHAR(16777216),
	DUEYR VARCHAR(16777216),
	DUEMO VARCHAR(16777216),
	DUEDAY VARCHAR(16777216),
	ARTYP VARCHAR(16777216),
	ARSUBTYP VARCHAR(16777216),
	DOCNUM VARCHAR(16777216),
	TRNCC VARCHAR(16777216),
	TRNYR VARCHAR(16777216),
	TRNMO VARCHAR(16777216),
	TRNDAY VARCHAR(16777216),
	DOCCC VARCHAR(16777216),
	DOCYR VARCHAR(16777216),
	DOCMO VARCHAR(16777216),
	DOCDAY VARCHAR(16777216),
	PLNEFFCC VARCHAR(16777216),
	PLNEFFMDY VARCHAR(16777216),
	RTENUM VARCHAR(16777216),
	RTEEFFCC VARCHAR(16777216),
	RTEEFFMDY VARCHAR(16777216),
	PHEFFCC VARCHAR(16777216),
	PHEFFMDY VARCHAR(16777216),
	PHST VARCHAR(16777216),
	BILLVL VARCHAR(16777216),
	BILFRQ VARCHAR(16777216),
	BILCYC VARCHAR(16777216),
	DOCAMT VARCHAR(16777216),
	COMAMT VARCHAR(16777216),
	ORGNID VARCHAR(16777216),
	STS VARCHAR(16777216),
	SRCPSTID VARCHAR(16777216),
	SRCTRNTYP VARCHAR(16777216),
	EECNT VARCHAR(16777216),
	EECNTNEW VARCHAR(16777216),
	EECNTREN VARCHAR(16777216),
	VOLAMT VARCHAR(16777216),
	VOLAMTNEW VARCHAR(16777216),
	VOLAMTREN VARCHAR(16777216),
	DOCAMTNEW VARCHAR(16777216),
	DOCAMTREN VARCHAR(16777216),
	FIL001 VARCHAR(16777216),
	BILLDATE VARCHAR(16777216),
	SRC_FILE_NAME VARCHAR(16777216),
	REC_CREATE_DTTM TIMESTAMP_NTZ(9),
	REC_UPDT_DTTM TIMESTAMP_NTZ(9),
	CYC_RUN_SK NUMBER(38,0),
	SRC_NM VARCHAR(16777216),
	PROCESS_FLAG VARCHAR(1),
	DQ_FLAG BOOLEAN
);


create or replace TABLE META_RULE_CTRL_TBL (
	RULE_SK NUMBER(38,0),
	RULE_TYP VARCHAR(16777216),
	RULE_NM VARCHAR(16777216),
	RULE_DESC VARCHAR(16777216),
	DQ_PROC_NM VARCHAR(16777216),
	COL_FORMAT VARCHAR(16777216),
	SRC_ENTITY VARCHAR(16777216),
	TGT_ENTITY VARCHAR(16777216),
	SRC_ATTR VARCHAR(16777216),
	SRC_KEY_COL VARCHAR(16777216),
	VALID_VALUES VARCHAR(16777216),
	RULE_SCRIPT VARCHAR(16777216),
	RULE_ACTION VARCHAR(16777216),
	PROCESS_TYP_CD VARCHAR(16777216),
	ACTI_IND VARCHAR(1),
	RULE_RUN_STS_CD VARCHAR(16777216),
	RULE_CUR_RUN_SK NUMBER(38,0),
	PROCESS_SK NUMBER(38,0),
	STEP_SK NUMBER(38,0),
	CYC_SK NUMBER(38,0),
	SCORE NUMBER(4,2),
	WEIGHTAGE NUMBER(4,2),
	THRESHOLD VARCHAR(16777216),
	AUD_DTTM TIMESTAMP_NTZ(9)
);

